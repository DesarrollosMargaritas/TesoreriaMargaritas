@page "/tesorero"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using TesoreriaMargaritas.Services
@attribute [Authorize(Roles = "Tesorero, Administrador")]
@rendermode RenderMode.InteractiveServer
@inject TesoreriaService TesoreriaService

<PageTitle>Panel de Tesorería</PageTitle>

<div class="container mt-5">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="text-primary border-bottom pb-2">
                <i class="bi bi-speedometer2"></i> Tablero de Control - Tesorería
            </h2>
            <p class="text-muted">Bienvenido. Aquí tiene un resumen de la actividad de hoy.</p>
        </div>
    </div>

    <!-- Sección de Resumen Rápido (KPIs) -->
    <div class="row mb-5">
        <div class="col-md-4">
            <div class="card bg-success text-white shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                        <h5 class="card-title"><i class="bi bi-cash-coin"></i> Ingresos de Hoy</h5>
                        <p class="card-text opacity-75">Total recaudado en el día</p>
                    </div>
                    <div class="mt-3 text-end">
                        @if (cargando)
                        {
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                        }
                        else
                        {
                            <h2 class="display-6 fw-bold">@totalHoy.ToString("C0")</h2>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- Espacio reservado para Salidas (Futuro) -->
            <div class="card bg-secondary text-white shadow-sm h-100 opacity-50">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-cart-x"></i> Salidas de Hoy</h5>
                    <p class="card-text">Próximamente</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- Espacio reservado para Balance (Futuro) -->
            <div class="card bg-primary text-white shadow-sm h-100 opacity-50">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-wallet2"></i> Balance Actual</h5>
                    <p class="card-text">Próximamente</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Menú de Operaciones -->
    <div class="row">
        <div class="col-12 mb-3">
            <h4 class="text-secondary">Operaciones Disponibles</h4>
        </div>

        <!-- Botón Grande para ir a Entradas -->
        <div class="col-md-6 mb-4">
            <a href="/operaciones/entradas" class="text-decoration-none">
                <div class="card h-100 border-success shadow-sm hover-effect">
                    <div class="card-body text-center p-5">
                        <i class="bi bi-plus-circle-fill text-success display-1 mb-3"></i>
                        <h3 class="text-dark">Registrar Entradas</h3>
                        <p class="text-muted">Gestionar ingresos, cuotas y aportes.</p>
                        <button class="btn btn-outline-success mt-2">Acceder al Módulo</button>
                    </div>
                </div>
            </a>
        </div>

        <!-- Botón Grande para ir a Salidas (Deshabilitado) -->
        <div class="col-md-6 mb-4">
            <a href="/operaciones/salidas" class="text-decoration-none">
            <div class="card h-100 border-danger shadow-sm opacity-50">
                <div class="card-body text-center p-5">
                    <i class="bi bi-dash-circle-fill text-danger display-1 mb-3"></i>
                    <h3 class="text-dark">Registrar Salidas</h3>
                    <p class="text-muted">Gestionar gastos, pagos y compras.</p>
                    <button class="btn btn-outline-danger mt-2">En Desarrollo</button>
                </div>
            </div>
            </a>
        </div>
    </div>
</div>

<style>
    .hover-effect:hover {
        transform: translateY(-5px);
        transition: transform 0.2s ease-in-out;
        cursor: pointer;
    }
</style>

@code {
    private decimal totalHoy = 0;
    private bool cargando = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Usamos el servicio para mostrar un dato real en el dashboard
            totalHoy = await TesoreriaService.ObtenerTotalEntradasHoyAsync();
        }
        finally
        {
            cargando = false;
        }
    }
}